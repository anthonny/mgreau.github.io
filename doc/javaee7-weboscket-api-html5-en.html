<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="Asciidoctor 0.1.4">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Java EE 7 and WebSocket API for Java (JSR 356)</title>
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }
audio, canvas, video { display: inline-block; }
audio:not([controls]) { display: none; height: 0; }
[hidden] { display: none; }
html { background: #fff; color: #000; font-family: sans-serif; -ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%; }
body { margin: 0; }
a:focus { outline: thin dotted; }
a:active, a:hover { outline: 0; }
h1 { font-size: 2em; margin: 0.67em 0; }
abbr[title] { border-bottom: 1px dotted; }
b, strong { font-weight: bold; }
dfn { font-style: italic; }
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }
mark { background: #ff0; color: #000; }
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }
pre { white-space: pre-wrap; }
q { quotes: "\201C" "\201D" "\2018" "\2019"; }
small { font-size: 80%; }
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }
sup { top: -0.5em; }
sub { bottom: -0.25em; }
img { border: 0; }
svg:not(:root) { overflow: hidden; }
figure { margin: 0; }
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }
legend { border: 0; padding: 0; }
button, input, select, textarea { font-family: inherit; font-size: 100%; margin: 0; }
button, input { line-height: normal; }
button, select { text-transform: none; }
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; cursor: pointer; }
button[disabled], html input[disabled] { cursor: default; }
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; padding: 0; }
input[type="search"] { -webkit-appearance: textfield; -moz-box-sizing: content-box; -webkit-box-sizing: content-box; box-sizing: content-box; }
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }
textarea { overflow: auto; vertical-align: top; }
table { border-collapse: collapse; border-spacing: 0; }
*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }
html, body { font-size: 100%; }
body { background: white; color: #222222; padding: 0; margin: 0; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }
a:hover { cursor: pointer; }
a:focus { outline: none; }
img, object, embed { max-width: 100%; height: auto; }
object, embed { height: 100%; }
img { -ms-interpolation-mode: bicubic; }
#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }
.left { float: left !important; }
.right { float: right !important; }
.text-left { text-align: left !important; }
.text-right { text-align: right !important; }
.text-center { text-align: center !important; }
.text-justify { text-align: justify !important; }
.hide { display: none; }
.antialiased, body { -webkit-font-smoothing: antialiased; }
img { display: inline-block; vertical-align: middle; }
textarea { height: auto; min-height: 50px; }
select { width: 100%; }
p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }
.subheader, #content #toctitle, .admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .videoblock > .title, .listingblock > .title, .literalblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title, .tableblock > caption { line-height: 1.4; color: #7a2518; font-weight: 300; margin-top: 0.2em; margin-bottom: 0.5em; }
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }
a { color: #005498; text-decoration: underline; line-height: inherit; }
a:hover, a:focus { color: #00467f; }
a img { border: none; }
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: Georgia, "URW Bookman L", Helvetica, Arial, sans-serif; font-weight: normal; font-style: normal; color: #ba3925; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.2125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #e99b8f; line-height: 0; }
h1 { font-size: 2.125em; }
h2 { font-size: 1.6875em; }
h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }
h4 { font-size: 1.125em; }
h5 { font-size: 1.125em; }
h6 { font-size: 1em; }
hr { border: solid #dddddd; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }
em, i { font-style: italic; line-height: inherit; }
strong, b { font-weight: bold; line-height: inherit; }
small { font-size: 60%; line-height: inherit; }
code { font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: normal; color: #6d180b; }
ul, ol, dl { font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }
ul, ol { margin-left: 1.5em; }
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }
abbr, acronym { text-transform: uppercase; font-size: 90%; color: #222222; border-bottom: 1px dotted #dddddd; cursor: help; }
abbr { text-transform: none; }
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: inherit; color: #555555; }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: #555555; }
blockquote, blockquote p { line-height: 1.6; color: #6f6f6f; }
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }
.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }
@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.4; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
.print-only { display: none !important; }
@media print { * { background: transparent !important; color: #000 !important; box-shadow: none !important; text-shadow: none !important; }
  a, a:visited { text-decoration: underline; }
  a[href]:after { content: " (" attr(href) ")"; }
  abbr[title]:after { content: " (" attr(title) ")"; }
  .ir a:after, a[href^="javascript:"]:after, a[href^="#"]:after { content: ""; }
  pre, blockquote { border: 1px solid #999; page-break-inside: avoid; }
  thead { display: table-header-group; }
  tr, img { page-break-inside: avoid; }
  img { max-width: 100% !important; }
  @page { margin: 0.5cm; }
  p, h2, h3, #toctitle, .sidebarblock > .content > .title { orphans: 3; widows: 3; }
  h2, h3, #toctitle, .sidebarblock > .content > .title { page-break-after: avoid; }
  .hide-on-print { display: none !important; }
  .print-only { display: block !important; }
  .hide-for-print { display: none !important; }
  .show-for-print { display: inherit !important; } }
table { background: white; margin-bottom: 1.25em; border: solid 1px #dddddd; }
table thead, table tfoot { background: whitesmoke; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: #222222; text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: #222222; }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f9f9f9; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.6; }
.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }
*:not(pre) > code { font-size: 0.9375em; padding: 1px 3px 0; white-space: nowrap; background-color: #f2f2f2; border: 1px solid #cccccc; -webkit-border-radius: 4px; border-radius: 4px; text-shadow: none; }
pre, pre > code { line-height: 1.4; color: inherit; font-family: Consolas, "Liberation Mono", Courier, monospace; font-weight: normal; }
kbd.keyseq { color: #555555; }
kbd:not(.keyseq) { display: inline-block; color: #222222; font-size: 0.75em; line-height: 1.4; background-color: #F7F7F7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset; margin: -0.15em 0.15em 0 0.15em; padding: 0.2em 0.6em 0.2em 0.5em; vertical-align: middle; white-space: nowrap; }
kbd kbd:first-child { margin-left: 0; }
kbd kbd:last-child { margin-right: 0; }
.menuseq, .menu { color: #090909; }
p a > code:hover { color: #561309; }
#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }
#header { margin-bottom: 2.5em; }
#header > h1 { color: black; font-weight: normal; border-bottom: 1px solid #dddddd; margin-bottom: -28px; padding-bottom: 32px; }
#header span { color: #6f6f6f; }
#header #revnumber { text-transform: capitalize; }
#header br { display: none; }
#header br + span { padding-left: 3px; }
#header br + span:before { content: "\2013 \0020"; }
#header br + span.author { padding-left: 0; }
#header br + span.author:before { content: ", "; }
#toc { border-bottom: 3px double #ebebeb; padding-bottom: 1.25em; }
#toc > ul { margin-left: 0.25em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
#toc ul { list-style-type: none; }
#toctitle { color: #7a2518; }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; }
  #toc.toc2 { position: fixed; width: 20em; left: 0; top: 0; border-right: 1px solid #ebebeb; border-bottom: 0; z-index: 1000; padding: 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; }
  #toc.toc2 > ul { font-size: .95em; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1.25em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; }
  body.toc2.toc-right #toc.toc2 { border-right: 0; border-left: 1px solid #ebebeb; left: auto; right: 0; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; border-width: 0; -webkit-border-radius: 4px; border-radius: 4px; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }
#content #toc a { text-decoration: none; }
#content #toctitle { font-weight: bold; font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif; font-size: 1em; padding-left: 0.125em; }
#footer { max-width: 100%; background-color: #222222; padding: 1.25em; }
#footer-text { color: #dddddd; line-height: 1.44; }
.sect1 { padding-bottom: 1.25em; }
.sect1 + .sect1 { border-top: 3px double #ebebeb; }
#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; width: 1em; margin-left: -1em; display: block; text-decoration: none; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: '\00A7'; font-size: .85em; vertical-align: text-top; display: block; margin-top: 0.05em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #ba3925; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #a53221; }
.imageblock, .literalblock, .listingblock, .verseblock, .videoblock { margin-bottom: 1.25em; }
.admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .videoblock > .title, .listingblock > .title, .literalblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-align: left; font-weight: bold; }
.tableblock > caption { text-align: left; font-weight: bold; white-space: nowrap; overflow: visible; max-width: 0; }
table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }
.admonitionblock > table { border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #dddddd; color: #6f6f6f; }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }
.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 4px; border-radius: 4px; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6, .exampleblock > .content p { color: #333333; }
.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6 { line-height: 1; margin-bottom: 0.625em; }
.exampleblock > .content h1.subheader, .exampleblock > .content h2.subheader, .exampleblock > .content h3.subheader, .exampleblock > .content .subheader#toctitle, .sidebarblock.exampleblock > .content > .subheader.title, .exampleblock > .content h4.subheader, .exampleblock > .content h5.subheader, .exampleblock > .content h6.subheader { line-height: 1.4; }
.exampleblock.result > .content { -webkit-box-shadow: 0 1px 8px #d9d9d9; box-shadow: 0 1px 8px #d9d9d9; }
.sidebarblock { border-style: solid; border-width: 1px; border-color: #d9d9d9; margin-bottom: 1.25em; padding: 1.25em; background: #f2f2f2; -webkit-border-radius: 4px; border-radius: 4px; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6, .sidebarblock p { color: #333333; }
.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6 { line-height: 1; margin-bottom: 0.625em; }
.sidebarblock h1.subheader, .sidebarblock h2.subheader, .sidebarblock h3.subheader, .sidebarblock .subheader#toctitle, .sidebarblock > .content > .subheader.title, .sidebarblock h4.subheader, .sidebarblock h5.subheader, .sidebarblock h6.subheader { line-height: 1.4; }
.sidebarblock > .content > .title { color: #7a2518; margin-top: 0; line-height: 1.6; }
.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }
.literalblock > .content pre, .listingblock > .content pre { background: none; border-width: 1px 0; border-style: dotted; border-color: #bfbfbf; -webkit-border-radius: 4px; border-radius: 4px; padding: 0.75em 0.75em 0.5em 0.75em; word-wrap: break-word; }
.literalblock > .content pre.nowrap, .listingblock > .content pre.nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
.literalblock > .content pre > code, .listingblock > .content pre > code { display: block; }
@media only screen { .literalblock > .content pre, .listingblock > .content pre { font-size: 0.8em; } }
@media only screen and (min-width: 768px) { .literalblock > .content pre, .listingblock > .content pre { font-size: 0.9em; } }
@media only screen and (min-width: 1280px) { .literalblock > .content pre, .listingblock > .content pre { font-size: 1em; } }
.listingblock > .content { position: relative; }
.listingblock:hover code[class*=" language-"]:before { text-transform: uppercase; font-size: 0.9em; color: #999; position: absolute; top: 0.375em; right: 0.375em; }
.listingblock:hover code.asciidoc:before { content: "asciidoc"; }
.listingblock:hover code.clojure:before { content: "clojure"; }
.listingblock:hover code.css:before { content: "css"; }
.listingblock:hover code.groovy:before { content: "groovy"; }
.listingblock:hover code.html:before { content: "html"; }
.listingblock:hover code.java:before { content: "java"; }
.listingblock:hover code.javascript:before { content: "javascript"; }
.listingblock:hover code.python:before { content: "python"; }
.listingblock:hover code.ruby:before { content: "ruby"; }
.listingblock:hover code.scss:before { content: "scss"; }
.listingblock:hover code.xml:before { content: "xml"; }
.listingblock:hover code.yaml:before { content: "yaml"; }
.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }
.listingblock.terminal pre .command:not([data-prompt]):before { content: '$'; }
table.pyhltable { border: 0; margin-bottom: 0; }
table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; }
table.pyhltable td.code { padding-left: .75em; padding-right: 0; }
.highlight.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #dddddd; }
.highlight.pygments .lineno { display: inline-block; margin-right: .25em; }
table.pyhltable .linenodiv { background-color: transparent !important; padding-right: 0 !important; }
.quoteblock { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
.quoteblock blockquote { margin: 0 0 1.25em 0; padding: 0 0 0.5625em 0; border: 0; }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: -.25em; padding-bottom: 0.5625em; font-size: inherit; color: #555555; }
.quoteblock .attribution br { display: none; }
.quoteblock .attribution cite { display: block; margin-bottom: 0.625em; }
table thead th, table tfoot th { font-weight: bold; }
table.tableblock.grid-all { border-collapse: separate; border-spacing: 1px; -webkit-border-radius: 4px; border-radius: 4px; border-top: 1px solid #dddddd; border-bottom: 1px solid #dddddd; }
table.tableblock.frame-topbot, table.tableblock.frame-none { border-left: 0; border-right: 0; }
table.tableblock.frame-sides, table.tableblock.frame-none { border-top: 0; border-bottom: 0; }
table.tableblock td .paragraph:last-child p, table.tableblock td > p:last-child { margin-bottom: 0; }
th.tableblock.halign-left, td.tableblock.halign-left { text-align: left; }
th.tableblock.halign-right, td.tableblock.halign-right { text-align: right; }
th.tableblock.halign-center, td.tableblock.halign-center { text-align: center; }
th.tableblock.valign-top, td.tableblock.valign-top { vertical-align: top; }
th.tableblock.valign-bottom, td.tableblock.valign-bottom { vertical-align: bottom; }
th.tableblock.valign-middle, td.tableblock.valign-middle { vertical-align: middle; }
p.tableblock.header { color: #222222; font-weight: bold; }
td > div.verse { white-space: pre; }
ol { margin-left: 1.75em; }
ul li ol { margin-left: 1.5em; }
dl dd { margin-left: 1.125em; }
dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }
ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }
ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }
ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }
ul.checklist li > p:first-child > i[class^="icon-check"]:first-child, ul.checklist li > p:first-child > input[type="checkbox"]:first-child { margin-right: 0.25em; }
ul.checklist li > p:first-child > input[type="checkbox"]:first-child { position: relative; top: 1px; }
ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }
.unstyled dl dt { font-weight: normal; font-style: normal; }
ol.arabic { list-style-type: decimal; }
ol.decimal { list-style-type: decimal-leading-zero; }
ol.loweralpha { list-style-type: lower-alpha; }
ol.upperalpha { list-style-type: upper-alpha; }
ol.lowerroman { list-style-type: lower-roman; }
ol.upperroman { list-style-type: upper-roman; }
ol.lowergreek { list-style-type: lower-greek; }
.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }
td.hdlist1 { padding-right: .8em; font-weight: bold; }
td.hdlist1, td.hdlist2 { vertical-align: top; }
.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }
.colist > table tr > td:first-of-type { padding: 0 .8em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }
.qanda > ol > li > p > em:only-child { color: #00467f; }
.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }
.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }
.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }
a.image { text-decoration: none; }
span.footnote, span.footnoteref { vertical-align: super; font-size: 0.875em; }
span.footnote a, span.footnoteref a { text-decoration: none; }
#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -.25em 0 .75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em; line-height: 1.3; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.2em; margin-bottom: .2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }
#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }
.gist .file-data > table { border: none; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }
div.unbreakable { page-break-inside: avoid; }
.big { font-size: larger; }
.small { font-size: smaller; }
.underline { text-decoration: underline; }
.overline { text-decoration: overline; }
.line-through { text-decoration: line-through; }
.aqua { color: #00bfbf; }
.aqua-background { background-color: #00fafa; }
.black { color: black; }
.black-background { background-color: black; }
.blue { color: #0000bf; }
.blue-background { background-color: #0000fa; }
.fuchsia { color: #bf00bf; }
.fuchsia-background { background-color: #fa00fa; }
.gray { color: #606060; }
.gray-background { background-color: #7d7d7d; }
.green { color: #006000; }
.green-background { background-color: #007d00; }
.lime { color: #00bf00; }
.lime-background { background-color: #00fa00; }
.maroon { color: #600000; }
.maroon-background { background-color: #7d0000; }
.navy { color: #000060; }
.navy-background { background-color: #00007d; }
.olive { color: #606000; }
.olive-background { background-color: #7d7d00; }
.purple { color: #600060; }
.purple-background { background-color: #7d007d; }
.red { color: #bf0000; }
.red-background { background-color: #fa0000; }
.silver { color: #909090; }
.silver-background { background-color: #bcbcbc; }
.teal { color: #006060; }
.teal-background { background-color: #007d7d; }
.white { color: #bfbfbf; }
.white-background { background-color: #fafafa; }
.yellow { color: #bfbf00; }
.yellow-background { background-color: #fafa00; }
span.icon > [class^="icon-"], span.icon > [class*=" icon-"] { cursor: default; }
.admonitionblock td.icon [class^="icon-"]:before { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #005498; color: #003f72; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }
.conum { display: inline-block; color: white !important; background-color: #222222; -webkit-border-radius: 100px; border-radius: 100px; text-align: center; width: 20px; height: 20px; font-size: 12px; font-weight: bold; line-height: 20px; font-family: Arial, sans-serif; font-style: normal; position: relative; top: -2px; letter-spacing: -1px; }
.conum * { color: white !important; }
.conum + b { display: none; }
.conum:after { content: attr(data-value); }
.conum:not([data-value]):empty { display: none; }
.literalblock > .content > pre, .listingblock > .content > pre { -webkit-border-radius: 0; border-radius: 0; }
</style>
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/3.2.1/css/font-awesome.min.css">
</head>
<body class="article">
<div id="header">
<h1>Java EE 7 and WebSocket API for Java (JSR 356)</h1>
<span id="author" class="author">2013-09-27</span><br>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Overview</div>
<div class="paragraph">
<p>This blog post describes the <strong><a href="http://jcp.org/en/jsr/detail?id=356">Java API for WebSocket Protocol (JSR 356)</a></strong> (which is one of four newest JSRs for the <strong><a href="http://jcp.org/en/jsr/detail?id=342">Java EE 7</a></strong> platform) and provides a concrete application <a href="http://wildfly-mgreau.rhcloud.com/usopen/">available online on OpenShift</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://mgreau.com/doc/javaee7-api-websocket-html5-en.pdf">Download an English PDF version</a></p>
</li>
<li>
<p><a href="http://mgreau.com/posts/2013/09/27/javaee7-api-websocket-html5.html">Read a French HTML version</a> or <a href="http://mgreau.com/doc/javaee7-api-websocket-html5.pdf">download a French PDF Version</a></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Once you will have read this post, you will be able to understand <a href="https://twitter.com/arungupta">Arun Gupta</a>'s definition about what is it possible to do with WebSocket technology.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>"WebSocket gives you bidirectionnal, full duplex, communication channel over a single TCP."
-- Arun Gupta (Java EE Evangelist chez Oracle) - Devoxx UK 2013</pre>
</div>
</div>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#java-ee-7-overview">Java EE 7 overview</a></li>
<li><a href="#demo-html5-jsr-356-api-application-deployed-on-wildfly-8-openshift">DEMO : HTML5/JSR-356 API application deployed on WildFly 8 (OpenShift)</a></li>
<li><a href="#websocket-ws-a-new-protocol-different-from-http">WebSocket (WS) : a new protocol different from HTTP</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#handshake">Handshake</a></li>
<li><a href="#data-transfer">Data transfer</a></li>
</ul>
</li>
<li><a href="#websocket-javascript-api-client">WebSocket Javascript API (Client)</a></li>
<li><a href="#jsr-386-java-api-for-websocket-protocol">JSR 386 : Java API for WebSocket protocol</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#websocket-server-endpoint">WebSocket Server Endpoint</a></li>
<li><a href="#annotations">Annotations</a></li>
<li><a href="#encoders-and-decoders">Encoders and Decoders</a></li>
<li><a href="#websocket-client-endpoint">WebSocket Client Endpoint</a></li>
</ul>
</li>
<li><a href="#us-open-application">US OPEN Application</a></li>
<li>
<ul class="sectlevel2">
<li><a href="#maven-dependencies-for-java-ee-7-api">Maven dependencies for Java EE 7 API</a></li>
<li><a href="#add-server-endpoint">Add Server Endpoint</a></li>
<li><a href="#encodes-and-decodes-messages">Encodes and Decodes messages</a></li>
<li><a href="#html5-web-client">HTML5 Web Client</a></li>
<li><a href="#source-code-on-github">Source code on Github</a></li>
<li><a href="#build-and-deploy-the-war">Build and Deploy the WAR</a></li>
</ul>
</li>
<li><a href="#benchmark-websocket-vs-rest">Benchmark : WebSocket VS REST</a></li>
<li><a href="#references-about-websocket">References about WebSocket</a></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul>
</div>
</div>
<div class="sect1">
<h2 id="java-ee-7-overview">Java EE 7 overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The <strong>Java Platform Enterprise Edition</strong> was released in Version 7 (Java EE 7) in <strong>June 2013</strong>.
In line with the two previous versions (Java EE 5 and Java EE 6) <strong>Java EE 7</strong> always proposes to simplify the work of the developer.
This version decorates previous versions with 3 main objectives :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>embraces <strong>HTML5</strong> (WebSocket API, JSON-P API, JAX-RS)</p>
</li>
<li>
<p>provide an <strong>even better productivity</strong> to developer (JMS)</p>
</li>
<li>
<p>meeting <strong>enterprise demands</strong> (Batch API, Concurrency Utilities)</p>
</li>
</ul>
</div>
<div id="javaee7_intro" class="imageblock">
<div class="content">
<img src="/images/javaee7_intro.png" alt="Java EE 7 goals">
</div>
<div class="title">Figure 1. The 3 goals of Java EE 7</div>
</div>
<div class="paragraph">
<p>Java Platform, Entreprise Edition 7 (JSR 342) can be summmed up around :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>4 newest specifications : <strong><code>Java API for WebSocket 1.0</code></strong>, <strong><code>Java API for JSON Processing 1.0</code></strong> , <strong><code>Batch Applications 1.0</code></strong> and <strong><code>Concurrency Utilities for Java EE 1.0</code></strong></p>
</li>
<li>
<p>3 specifications with major updates : <strong><code>JMS 2.0</code></strong>, <strong><code>JAX-RS 2.0</code></strong> and <strong><code>EL 3.0</code></strong></p>
</li>
<li>
<p>and 6 specifications with minor updates : <strong><code>JPA 2.1</code></strong>, <strong><code>Servlet 3.1</code></strong>, <strong><code>EJB 3.2</code></strong>, <strong><code>CDI 1.1</code></strong>, <strong><code>JSF 2.2</code></strong> and <strong><code>Bean Validation 1.1</code></strong></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="demo-html5-jsr-356-api-application-deployed-on-wildfly-8-openshift">DEMO : HTML5/JSR-356 API application deployed on WildFly 8 (OpenShift)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you want to see right away what it looks like, you can access <code><a href="http://wildfly-mgreau.rhcloud.com/usopen/">the online application</a></code> whose code will be in part explained in this article.
It&#8217;s an application that give you the ability :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>to follow a tennis match in <strong>live mode</strong> (Final U.S. Open 2013) without any action other than the first connection to the URL</p>
</li>
<li>
<p>to bet on the winner of the match</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You will say: <em>"Nothing special !"</em>, and you&#8217;re right :)</p>
</div>
<div class="paragraph">
<p>At first glance, it sounds like something already seen in many of today&#8217;s applications, but it&#8217;s the technique used behind which does matter because, as you will see below, everything is based around the <strong>standard of the new WebSocket protocol (ws:// ou wss://)</strong> and not on "HTTP hacking".</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">The technologies used for the development of this application are :</div>
<div class="ulist">
<ul>
<li>
<p>Frontend : <code>HTML5</code>, <code>CSS</code>, <code>Javascript (WebSocket API)</code> with <em>Bootstrap CSS but without JQuery and BootstrapJS</em></p>
</li>
<li>
<p>Backend : <code>Java API for WebSocket</code>, <code>EJB</code>, <code>JSON-P</code></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div id="websocket_example" class="imageblock">
<div class="content">
<a class="image" href="http://wildfly-mgreau.rhcloud.com/usopen/"><img src="/images/websocket_example.png" alt="Implementation of WebSocket (Java API et Javascript API)"></a>
</div>
<div class="title">Figure 2. US Open Application  - Implementation of WebSocket (Java API et Javascript API)</div>
</div>
<div class="paragraph">
<p>Nope! This demonstration is <strong>not a chat application :)</strong>
It&#8217;s obvious that the "chat demo" is the one that first comes to mind to illustrate the use of WebSocket technology. However, there are many other use cases, such as collaborative work on a text document online or online games like chess presented at the <a href="https://blogs.oracle.com/javaone/entry/the_javaone_2013_technical_keynote">JavaOne 2013 keynote</a>.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p><em>This application is available on the Cloud thanks to <a href="https://www.openshift.com/">OpenShift</a>, the cloud computing PaaS product by RedHat. It&#8217;s deployed on WildFly 8.0.0-Beta3 (normaly certified Java EE 7 to the end of 2013). To set up an application server like WildFly on OpenShit, you just need to read <a href="https://www.openshift.com/blogs/deploy-websocket-web-applications-with-jboss-wildfly">this Shekhar Gulati&#8217;s blog post</a></em></p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="websocket-ws-a-new-protocol-different-from-http">WebSocket (WS) : a new protocol different from HTTP</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="http://tools.ietf.org/html/rfc2616">HTTP</a> is the standard protocol for the Web, it&#8217;s very effective for a lot of use cases but, nevertheless, has <strong>some drawbacks</strong> in the case of <strong>interactive Web applications</strong> :</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>half-duplex</strong> : based on the request/response pattern, the client sends a request and the server performs processing before sending a response, the client is forced to wait for a server response</p>
</li>
<li>
<p><strong>verbose</strong> : a lot of information are send in HTTP headers associated with the message, both in the HTTP request and in the HTTP response</p>
</li>
<li>
<p>in order to add a <strong>server push</strong> mode, you need to use workaround (polling, long polling, Comet/Ajax) since there is no standard</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This protocol is not optimized to scale on large applications that have significant needs of real-time bi-directional communication. This is why the <strong>new WebSocket protocol</strong> offers more advanced features than HTTP because it is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>based on <strong><code>1 unique TCP connection between 2 peers</code></strong> (whereas each HTTP request/response needs a new TCP connection)</p>
</li>
<li>
<p><strong><code>bidirectionnal</code></strong> : client can send message to server and server can also send message to client</p>
</li>
<li>
<p><strong><code>full-duplex</code></strong> : client can send multiple messages to server, as well as server to client without waiting for a response from each other</p>
</li>
</ul>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p><em>The term <strong>client</strong> is used only to define the one that initiate the connection. Once the connection is established, client and server become both <strong>peers</strong>, with the same capacity.</em></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The WebSocket protocol was originally intended to be part of the HTML5 specification but as HTML5 will be officially released in 2014, the WebSocket protocol is finally set, as well as HTTP protocol, by an IETF specification, <a href="http://tools.ietf.org/html/rfc6455">with RFC 6455</a>.</p>
</div>
<div class="paragraph">
<p>As shown in the diagram below, the <strong>WebSocket protocol works in two phases</strong> named :</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong><code>handshake</code></strong></p>
</li>
<li>
<p><strong><code>data transfer</code></strong></p>
</li>
</ol>
</div>
<div id="websocket_protocol" class="imageblock">
<div class="content">
<img src="/images/WebSocket_Protocol.png" alt="Diagram which explain how does the WebSocket protocol work" width="550">
</div>
<div class="title">Figure 3. How does the WebSocket protocol work</div>
</div>
<div class="sect2">
<h3 id="handshake">Handshake</h3>
<div class="paragraph">
<p>The <strong>Handshake</strong> phase is a <strong>unique HTTP request/response</strong> between the one who initiate the connection (peer client) and the peer server. This HTTP exchange is specific because it uses the concept of <a href="http://tools.ietf.org/html/rfc2616#section-14.42"><strong>Upgrade, defined in the HTTP specification</strong></a>.
The principle is simple : <strong>Upgrade HTTP</strong> allows the client to ask the server to change the communication protocol and thus ensure that the client and server can discuss using a protocol other than HTTP.</p>
</div>
<div id="eg1-callouts" class="exampleblock">
<div class="title">Example 1. HTTP Handshake sample request</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="text language-text">GET /usopen/matches/1234 HTTP/1.1     <i class="conum" data-value="1"></i><b>(1)</b>
Host: wildfly-mgreau.rhcloud.com:8000  <i class="conum" data-value="2"></i><b>(2)</b>
Upgrade: websocket  <i class="conum" data-value="3"></i><b>(3)</b>
Connection: Upgrade <i class="conum" data-value="4"></i><b>(4)</b>
Origin: http://wildfly-mgreau.rhcloud.com
Sec-WebSocket-Key:0EK7XmpTZL341oOh7x1cDw==
Sec-WebSocket-Version:13</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>HTTP GET method and HTTP 1.1 version required</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Host used for the WebSocket connection</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Request to upgrade to the WebSocket protocol</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Request to upgrade from HTTP to another protocol</td>
</tr>
</table>
</div>
</div>
</div>
<div id="eg2-callouts" class="exampleblock">
<div class="title">Example 2. HTTP Handshake Response sample</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="text language-text">HTTP/1.1 101 Switching Protocols <i class="conum" data-value="1"></i><b>(1)</b>
Connection:Upgrade
Sec-WebSocket-Accept:SuQ5/hh0kStSr6oIzDG6gRfTx2I=
Upgrade:websocket <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>HTTP Response Code 101 : server is compatible and accept to send messages through another protocol</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Upgrade to the WebSocket protocol is accepted</td>
</tr>
</table>
</div>
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p><em>When the upgrade request from HTTP to WebSocket protocol is approved by the endpoint server, it&#8217;s no longer possible to use HTTP communication, all exchanges have to be made through the WebSocket protocol.</em></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="data-transfer">Data transfer</h3>
<div class="paragraph">
<p>Once the <strong>handshake</strong> is approved, the use of WebSocket protocol is established. There are an open connection on the <em>peer server side</em> as well on the <em>peer client side</em>, callback handlers are called to initiate the communication.<br>
The <strong>Data transfer</strong> can now begin, so the 2 peers can exchange messages in a bidirectionnal and full-duplex communication.</p>
</div>
<div class="paragraph">
<p>As shown in the diagram named <strong>Figure 3</strong>, the <code>peer server</code> can send multiple messages (<em>in this example : 1 message to each point of the game</em>) without any <code>peer client</code> response and the peer client can also send messages at any time (<em>in this example : betting on the winner of the match</em>).
Each peer can send a specific message to close the connection.<br></p>
</div>
<div class="paragraph">
<p>With Java EE7 Platform, the <code>peer server side</code> code is written in <strong>Java</strong> while the <code>peer client side</code> code is in <strong>Java or Javascript</strong>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="websocket-javascript-api-client">WebSocket Javascript API (Client)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To communicate from a Web application with a server using the WebSocket protocol, it&#8217;s necessary to use a <strong>client Javascript API</strong>. It&#8217;s the role of W3C to define this API.
The W3C specification for the <a href="http://w3.org/TR/websockets/">JavaScript WebSocket API</a> is being finalized. <a href="http://www.w3.org/TR/websockets/#websocket">The WebSocket interface</a> provides, among others, the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>an attribute to define the connection URL to the server Endpoint (<code>url</code>)</p>
</li>
<li>
<p>an attribute to know the status of the connection (<code>readyState</code> : CONNECTING, OPEN, CLOSING, CLOSED)</p>
</li>
<li>
<p>some <strong>Event Handler</strong> in connection with the WebSocket lifecycle, eg :</p>
<div class="ulist">
<ul>
<li>
<p>the Event Handler <code>onopen</code> is called when a new connection is open</p>
</li>
<li>
<p>the Event Handler <code>onerror</code> is called when an error occured during the communication</p>
</li>
<li>
<p>the Event Handler <code>onmessage</code> is called when a message arrives from the server</p>
</li>
</ul>
</div>
</li>
<li>
<p>methods (<code>send(DOMString data)</code>, <code>send(Blob data)</code>) with which it&#8217;s possible to send different type of flow(text, binary) to the Endpoint server</p>
</li>
</ul>
</div>
<div id="eg3-callouts" class="exampleblock">
<div class="title">Example 3. Javascript source code example, from <a href="http://websocket.org">http://websocket.org</a></div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="javascript language-javascript"><span style="color:#080;font-weight:bold">var</span> wsUri = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">ws://echo.websocket.org/</span><span style="color:#710">&quot;</span></span>;

<span style="color:#080;font-weight:bold">function</span> <span style="color:#06B;font-weight:bold">testWebSocket</span>() {

        websocket = <span style="color:#080;font-weight:bold">new</span> WebSocket(wsUri);
        websocket.<span style="color:#06B;font-weight:bold">onopen</span> = <span style="color:#080;font-weight:bold">function</span>(evt) { onOpen(evt) };
        websocket.<span style="color:#06B;font-weight:bold">onclose</span> = <span style="color:#080;font-weight:bold">function</span>(evt) { onClose(evt) };
        websocket.<span style="color:#06B;font-weight:bold">onmessage</span> = <span style="color:#080;font-weight:bold">function</span>(evt) { onMessage(evt) };
        websocket.<span style="color:#06B;font-weight:bold">onerror</span> = <span style="color:#080;font-weight:bold">function</span>(evt) { onError(evt) }; }
}

<span style="color:#080;font-weight:bold">function</span> <span style="color:#06B;font-weight:bold">onOpen</span>(evt) {
        writeToScreen(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">CONNECTED</span><span style="color:#710">&quot;</span></span>);
        doSend(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">WebSocket rocks</span><span style="color:#710">&quot;</span></span>);
}
<span style="color:#080;font-weight:bold">function</span> <span style="color:#06B;font-weight:bold">onClose</span>(evt) {
        writeToScreen(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">DISCONNECTED</span><span style="color:#710">&quot;</span></span>);
}
<span style="color:#080;font-weight:bold">function</span> <span style="color:#06B;font-weight:bold">onMessage</span>(evt) {
        writeToScreen(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">&lt;span style=&quot;color: blue;&quot;&gt;RESPONSE: </span><span style="color:#710">'</span></span> + evt.data+<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">&lt;/span&gt;</span><span style="color:#710">'</span></span>);
        websocket.close();
}

<span style="color:#080;font-weight:bold">function</span> <span style="color:#06B;font-weight:bold">onError</span>(evt) {
        writeToScreen(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">&lt;span style=&quot;color: red;&quot;&gt;ERROR:&lt;/span&gt; </span><span style="color:#710">'</span></span> + evt.data);
}
<span style="color:#080;font-weight:bold">function</span> <span style="color:#06B;font-weight:bold">doSend</span>(message) {
        writeToScreen(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">SENT: </span><span style="color:#710">&quot;</span></span> + message);
        websocket.send(message);
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="jsr-386-java-api-for-websocket-protocol">JSR 386 : Java API for WebSocket protocol</h2>
<div class="sectionbody">
<div class="paragraph">
<p>As the W3C defines how to use WebSocket in Javascript, the <strong>Java Communitee Process (JCP)</strong> does the same for the Java world via the JSR 386.<br>
JSR 356 defines a <a href="http://jcp.org/en/jsr/detail?id=356">Java API for WebSocket protocol</a> which be part of <strong>Java EE Web Profile</strong> and give the ability to :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>create a <code><strong>WebSocket Endpoint</strong></code> (server or client), the name given to the Java component that can communicate via the WebSocket protocol</p>
</li>
<li>
<p>the choice of <strong>annotation</strong> or programmatic approach</p>
</li>
<li>
<p><strong>send and consume messages</strong> controls, text or binary via this protocol</p>
<div class="ulist">
<ul>
<li>
<p>manage the message as a complete message or a sequence of partial messages</p>
</li>
<li>
<p>send or receive messages as Java objects (concept of <strong>encoders / decoders</strong>)</p>
</li>
<li>
<p>send messages <strong>synchronously or asynchronously</strong></p>
</li>
</ul>
</div>
</li>
<li>
<p>configure and manage <strong>WebSocket Session</strong> (timeout, cookies&#8230;)</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
<em>The open source JSR-356 RI (Reference Implementation) is <a href="https://tyrus.java.net/">the project Tyrus</a></em>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="websocket-server-endpoint">WebSocket Server Endpoint</h3>
<div class="paragraph">
<p>The transformation of a Plain Old Java Object (POJO) to a <strong>Server WebSocket Endpoint</strong> (namely capable of handling requests from different customers on the same URI) is <strong>very easy</strong> since you only have to annotate the Java Class with <strong>@ServerEndpoint</strong> and one method with <strong>@OnMessage</strong> :</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">javax.websocket.OnMessage</span>;
<span style="color:#080;font-weight:bold">import</span> <span style="color:#B44;font-weight:bold">javax.websocket.ServerEndpoint</span>;

<span style="color:#007">@ServerEndpoint</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/echo</span><span style="color:#710">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">EchoServer</span> {

        <span style="color:#007">@OnMessage</span> <i class="conum" data-value="2"></i><b>(2)</b>
        <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a5;font-weight:bold">String</span> handleMessage(<span style="color:#0a5;font-weight:bold">String</span> message){
                <span style="color:#080;font-weight:bold">return</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Thanks for the message: </span><span style="color:#710">&quot;</span></span> + message;
        }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>@ServerEndpoint transforms this POJO into a WebSocket Endpoint, the <strong>value</strong> attribute is mandatory in order to set the access URI to this Endpoint</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>the <em>handleMessage</em> method will be invoked for each received message</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="annotations">Annotations</h3>
<div class="paragraph">
<p>This Java API provides several types of annotations to be fully compatible with the WebSocket protocol :</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:50%;">
<col style="width:50%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Annotation</th>
<th class="tableblock halign-left valign-top">Role</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@ServerEndpoint</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declare a Server Endpoint</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@ClientEndpoint</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declare a Client Endpoint</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@OnOpen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declare this method handles open events</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@OnMessage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declare this method handles Websocket messages</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@OnError</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declare this method handles error</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">@OnClose</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Declare this method handles WebSocket close events</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><code>@ServerEndpoint</code> attributes are listed below :</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">value</dt>
<dd>
<p>relative URI or template URI (ex: "/echo", "/matches/{match-id}")</p>
</dd>
<dt class="hdlist1">decoders</dt>
<dd>
<p>list of message decoder classnames</p>
</dd>
<dt class="hdlist1">encoders</dt>
<dd>
<p>liste of message encoder classnames</p>
</dd>
<dt class="hdlist1">subprotocols</dt>
<dd>
<p>list of the names of the supported subprotocols (ex: <a href="http://wamp.ws)">http://wamp.ws)</a></p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="encoders-and-decoders">Encoders and Decoders</h3>
<div class="paragraph">
<p>As described earlier in this article, the Endpoint server can receive different types of content in messages : data in text format (JSON, XML &#8230;) or binary format.<br>
To effectively manage the messages from <em>peers client</em> or to them in the application business code, it is possible to create <strong>Encoders and Decoders</strong> Java classes.</p>
</div>
<div class="paragraph">
<p>Whatever the transformation algorithm, it will then be possible to transform  :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the business POJO to flow in the desired format for communication (JSON, XML, Binary &#8230;)</p>
</li>
<li>
<p>inflows in specific format(JSON, XML..) to the business POJO</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Thus, the application code is structured so that the business logic is not affected by the type and format of messages exchanged between the <em>peer server</em> and <em>peers client</em> flows.</p>
</div>
<div class="paragraph">
<p>A concrete example is presented later in the article.</p>
</div>
</div>
<div class="sect2">
<h3 id="websocket-client-endpoint">WebSocket Client Endpoint</h3>
<div class="paragraph">
<p>This Java API also offers support for creating client-side Java Endpoints.</p>
</div>
<div id="eg4-callouts" class="exampleblock">
<div class="title">Example 4. Java Client Endpoint sample</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span style="color:#007">@ClientEndpoint</span>
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">HelloClient</span> {

        <span style="color:#007">@OnMessage</span>
        <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a5;font-weight:bold">String</span> message(<span style="color:#0a5;font-weight:bold">String</span> message){
                <span style="color:#777">// code</span>
        }
}

WebSocketContainer c = ContainerProvider.getWebSocketContainer();
c.connectToServer(HelloClient.class, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">hello</span><span style="color:#710">&quot;</span></span>);</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="us-open-application">US OPEN Application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The sample application is deployed as a WAR outcome of a build with Apache Maven.
In addition to the traditional management WebSocket lifecycle, the sending messages workflow is as follows :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>at each point of the match, <em>peers clients</em> receive data match (score, service&#8230;)</p>
</li>
<li>
<p>the <em>peer client</em> may send a message to bet on the winner of the match</p>
</li>
<li>
<p>at the end of the match, <em>peers client</em> receive a message containing the name of the winner</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>All messages are exchanged in JSON format</strong><br></p>
</div>
<div class="paragraph">
<p>The project structure is as follows :</p>
</div>
<div id="eg5-callouts" class="exampleblock">
<div class="title">Example 5. Maven project structure</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="text language-text">+ src/main/java
   |+ com.mgreau.wildfly.websocket
      |+ decoders
         |- MessageDecoder.java   <i class="conum" data-value="1"></i><b>(1)</b>
      |+ encoders       <i class="conum" data-value="2"></i><b>(2)</b>
         |- BetMessageEncoder.java
         |- MatchMessageEncoder.java
      |+ messages       <i class="conum" data-value="3"></i><b>(3)</b>
         |- BetMessage.java
         |- MatchMessage.java
         |- Message.java
      |- MatchEndpoint.java    <i class="conum" data-value="4"></i><b>(4)</b>
      |- StarterService.java   <i class="conum" data-value="5"></i><b>(5)</b>
      |- TennisMatch.java      <i class="conum" data-value="6"></i><b>(6)</b>
+ src/main/resources
+ scr/main/webapp
   |+ css
   |+ images
   |- index.html
   |- websocket.js  <i class="conum" data-value="7"></i><b>(7)</b>
pom.xml</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Decode JSON messages sent from the <em>peer client</em> (about bet on the winner) to a POJO (<em>BetMessage</em>)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Encode in JSON format (via JSON-P), all messages about the winner and the match details for <em>peers clients</em></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>POJOs to handle messages sent between peers</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The application WebSocket Server Endpoint (<em>peer server</em>)</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>EJB @Startup in order to initialize this application at deployment time</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>POJO to handle informations about the match</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>File containing the implementation of Javascript API for WebSocket protocol to handle the client side of the communication</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="maven-dependencies-for-java-ee-7-api">Maven dependencies for Java EE 7 API</h3>
<div id="eg6-callouts" class="exampleblock">
<div class="title">Example 6. pom.xml with Java EE 7 dependencies</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="xml language-xml"><span style="color:#070">&lt;project&gt;</span>
...
<span style="color:#070">&lt;properties&gt;</span>
        <span style="color:#070">&lt;project.build.sourceEncoding&gt;</span>UTF-8<span style="color:#070">&lt;/project.build.sourceEncoding&gt;</span>
        <span style="color:#777">&lt;!-- Java EE 7 --&gt;</span>
        <span style="color:#070">&lt;javaee.api.version&gt;</span>7.0<span style="color:#070">&lt;/javaee.api.version&gt;</span>
<span style="color:#070">&lt;/properties</span>

<span style="color:#070">&lt;dependencies&gt;</span>
        <span style="color:#070">&lt;dependency&gt;</span>
                <span style="color:#070">&lt;groupId&gt;</span>javax<span style="color:#070">&lt;/groupId&gt;</span> <i class="conum" data-value="1"></i><b>(1)</b>
                <span style="color:#070">&lt;artifactId&gt;</span>javaee-api<span style="color:#070">&lt;/artifactId&gt;</span>
                <span style="color:#070">&lt;version&gt;</span>${javaee.api.version}<span style="color:#070">&lt;/version&gt;</span>
                <span style="color:#070">&lt;scope&gt;</span>provided<span style="color:#070">&lt;/scope&gt;</span>
        <span style="color:#070">&lt;/dependency&gt;</span>
<span style="color:#070">&lt;/dependencies&gt;</span>
...
<span style="color:#070">&lt;/project&gt;</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>It&#8217;s important to use the Java EE 7 dependencies to be able to deploy the same application in multiple Java EE application servers (WildFly, Glassfish&#8230;) <strong>without changing code</strong>.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="add-server-endpoint">Add Server Endpoint</h3>
<div class="paragraph">
<p>This endpoint can receive messages about betting on the winner of the match and it can also send to <em>peers client</em> all informations about the course of the match.</p>
</div>
<div id="eg7-callouts" class="exampleblock">
<div class="title">Example 7. Server Endpoint : MatchEndpoint.java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span style="color:#007">@ServerEndpoint</span>(
                value = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">/matches/{match-id}</span><span style="color:#710">&quot;</span></span>,  <i class="conum" data-value="1"></i><b>(1)</b>
                        decoders = { MessageDecoder.class }, <i class="conum" data-value="2"></i><b>(2)</b>
                        encoders = { MatchMessageEncoder.class, BetMessageEncoder.class } <i class="conum" data-value="3"></i><b>(3)</b>
                )
<span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MatchEndpoint</span> {

        <span style="color:#088;font-weight:bold">private</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#088;font-weight:bold">final</span> <span style="color:#0a5;font-weight:bold">Logger</span> logger = <span style="color:#0a5;font-weight:bold">Logger</span>.getLogger(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">MatchEndpoint</span><span style="color:#710">&quot;</span></span>);

        <span style="color:#777">/* Queue for all open WebSocket sessions */</span>
        <span style="color:#088;font-weight:bold">static</span> <span style="color:#0a5;font-weight:bold">Queue</span>&lt;Session&gt; queue = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a5;font-weight:bold">ConcurrentLinkedQueue</span>&lt;&gt;();

        <span style="color:#007">@OnOpen</span>
        <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> openConnection(Session session,
                                <span style="color:#007">@PathParam</span>(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">match-id</span><span style="color:#710">&quot;</span></span>) <span style="color:#0a5;font-weight:bold">String</span> matchId) {        <i class="conum" data-value="4"></i><b>(4)</b>
            <span style="color:#777">/* Register this connection in the queue */</span>
            queue.add(session);
            session.getUserProperties().put(matchId, <span style="color:#069">true</span>);
            logger.log(<span style="color:#0a5;font-weight:bold">Level</span>.INFO, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Connection opened for game : </span><span style="color:#710">&quot;</span></span> + matchId);
        }

        <span style="color:#088;font-weight:bold">public</span> <span style="color:#088;font-weight:bold">static</span> <span style="color:#339;font-weight:bold">void</span> send(MatchMessage msg, <span style="color:#0a5;font-weight:bold">String</span> matchId) {
          <span style="color:#080;font-weight:bold">try</span> {
            <span style="color:#777">/* Send updates to all open WebSocket sessions for this match */</span>
            <span style="color:#080;font-weight:bold">for</span> (Session session : queue) {
              <span style="color:#080;font-weight:bold">if</span> (<span style="color:#0a5;font-weight:bold">Boolean</span>.TRUE.equals(session.getUserProperties().get(matchId))){
                <span style="color:#080;font-weight:bold">if</span> (session.isOpen()){
                      session.getBasicRemote().sendObject(msg);        <i class="conum" data-value="5"></i><b>(5)</b>
                      logger.log(<span style="color:#0a5;font-weight:bold">Level</span>.INFO, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Score Sent: {0}</span><span style="color:#710">&quot;</span></span>, msg);
                }
              }
            }
          } <span style="color:#080;font-weight:bold">catch</span> (<span style="color:#C00;font-weight:bold">IOException</span> | EncodeException e) {
            logger.log(<span style="color:#0a5;font-weight:bold">Level</span>.INFO, e.toString());
          }
        }

        <span style="color:#007">@OnMessage</span>
        <span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">void</span> message(<span style="color:#088;font-weight:bold">final</span> Session session, BetMessage msg) {        <i class="conum" data-value="6"></i><b>(6)</b>
            logger.log(<span style="color:#0a5;font-weight:bold">Level</span>.INFO, <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">Received: Bet Match Winner - {0}</span><span style="color:#710">&quot;</span></span>, msg.getWinner());
            session.getUserProperties().put(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">betMatchWinner</span><span style="color:#710">&quot;</span></span>, msg);
        }
...
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Access URI to this Endpoint, as the application context-root is <em>/usopen</em>, the final URL looks like this : <code>ws://&lt;host&gt;:&lt;port&gt;/usopen/matches/1234</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><em>MessageDecoder</em> transforms the incoming JSON flow (about the bet on the winner) into a POJO <em>BetMessage</em></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>This 2 encoders add the ability to transform from <em>MatchMessage</em> POJO and <em>BetMessage</em> POJO to messages in JSON format</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>@PathParam</code> annotation allows to extract part of the WebSocket request and pass the value (id match) as the parameter of the method, it is possible to manage several match with multiple clients for each match.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Send, to connected peers, messages about the course of the match. Thanks to the <em>MatchMessageEncoder</em> object, simply pass the <em>MatchMessage</em> object.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Handle received messages about the bet on the winner, thanks to the <em>MessageDecoder</em> object, one of the parameters of this method is a <em>BetMessage</em> object</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="encodes-and-decodes-messages">Encodes and Decodes messages</h3>
<div class="paragraph">
<p>To encode or decode messages exchanged between peers, simply implement the appropriate interface according to the message type (text, binary) and direction of processing (encoding, decoding), then redefine the associated method.<br>
In the example below, it&#8217;s the <strong>encoder</strong> for MatchMessage POJO to JSON format. The API used to perform this treatment is also a new API released with Java EE 7 : <a href="http://jcp.org/en/jsr/detail?id=353">Java API for JSON Processiong (JSON-P)</a></p>
</div>
<div id="eg8-callouts" class="exampleblock">
<div class="title">Example 8. Text Encoder : MatchMessageEncoder.java</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="java language-java"><span style="color:#088;font-weight:bold">public</span> <span style="color:#339;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">MatchMessageEncoder</span> <span style="color:#088;font-weight:bold">implements</span> <span style="color:#0a5;font-weight:bold">Encoder</span>.Text&lt;MatchMessage&gt; {

        <span style="color:#007">@Override</span>
        <span style="color:#088;font-weight:bold">public</span> <span style="color:#0a5;font-weight:bold">String</span> encode(MatchMessage m) <span style="color:#088;font-weight:bold">throws</span> EncodeException {
                <span style="color:#0a5;font-weight:bold">StringWriter</span> swriter = <span style="color:#080;font-weight:bold">new</span> <span style="color:#0a5;font-weight:bold">StringWriter</span>();
                <span style="color:#080;font-weight:bold">try</span> (JsonWriter jsonWrite = Json.createWriter(swriter)) {
                        JsonObjectBuilder builder = Json.createObjectBuilder();
                        builder.add(
                                <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">match</span><span style="color:#710">&quot;</span></span>,
                                Json.createObjectBuilder()
                                        .add(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">serve</span><span style="color:#710">&quot;</span></span>, m.getMatch().getServe())
                                        .add(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">title</span><span style="color:#710">&quot;</span></span>, m.getMatch().getTitle())
                                        ...
                        }

                        jsonWrite.writeObject(builder.build());
                }
                <span style="color:#080;font-weight:bold">return</span> swriter.toString();
        }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="html5-web-client">HTML5 Web Client</h3>
<div class="paragraph">
<p>The single HTML page of this application loads the <strong>websocket.js</strong> file to implement the Javascript WebSocket API and thus interact with the Java Server Endpoint.</p>
</div>
<div id="eg9-callouts" class="exampleblock">
<div class="title">Example 9. API Javascript implemented into websocket.js</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="CodeRay nowrap"><code class="javascript language-javascript"><span style="color:#080;font-weight:bold">var</span> wsUrl;
<span style="color:#080;font-weight:bold">if</span> (window.location.protocol == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">https:</span><span style="color:#710">'</span></span>) {  <i class="conum" data-value="1"></i><b>(1)</b>
        wsUrl = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">wss://</span><span style="color:#710">'</span></span> + window.location.host + <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">:8443/usopen/matches/1234</span><span style="color:#710">'</span></span>;
} <span style="color:#080;font-weight:bold">else</span> {
        wsUrl = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">ws://</span><span style="color:#710">'</span></span> + window.location.host + <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">:8000/usopen/matches/1234</span><span style="color:#710">'</span></span>;
}

<span style="color:#080;font-weight:bold">function</span> <span style="color:#06B;font-weight:bold">createWebSocket</span>(host) {
        <span style="color:#080;font-weight:bold">if</span> (!window.WebSocket) {    <i class="conum" data-value="2"></i><b>(2)</b>
        ...
        } <span style="color:#080;font-weight:bold">else</span> {
                socket = <span style="color:#080;font-weight:bold">new</span> WebSocket(host);   <i class="conum" data-value="3"></i><b>(3)</b>
                socket.<span style="color:#06B;font-weight:bold">onopen</span> = <span style="color:#080;font-weight:bold">function</span>() {
                        document.getElementById(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">m1-status</span><span style="color:#710">&quot;</span></span>).innerHTML = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">CONNECTED...</span><span style="color:#710">'</span></span>;
                };
                socket.<span style="color:#06B;font-weight:bold">onclose</span> = <span style="color:#080;font-weight:bold">function</span>() {
                        document.getElementById(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">m1-status</span><span style="color:#710">&quot;</span></span>).innerHTML = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">FINISHED</span><span style="color:#710">'</span></span>;
                };
                ...
                socket.<span style="color:#06B;font-weight:bold">onmessage</span> = <span style="color:#080;font-weight:bold">function</span>(msg) {
                        <span style="color:#080;font-weight:bold">try</span> {
                                console.log(data);
                                <span style="color:#080;font-weight:bold">var</span> obj = JSON.parse(msg.data);     <i class="conum" data-value="4"></i><b>(4)</b>
                                <span style="color:#080;font-weight:bold">if</span> (obj.hasOwnProperty(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">match</span><span style="color:#710">&quot;</span></span>)){   <i class="conum" data-value="5"></i><b>(5)</b>
                                        <span style="color:#777">//title</span>
                                        m1title.innerHTML = obj.match.title;
                                        <span style="color:#777">// comments</span>
                                        m1comments.value = obj.match.comments;
                                        <span style="color:#777">// serve</span>
                                        <span style="color:#080;font-weight:bold">if</span> (obj.match.serve === <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">player1</span><span style="color:#710">&quot;</span></span>) {
                                                m1p1serve.innerHTML = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">S</span><span style="color:#710">&quot;</span></span>;
                                                m1p2serve.innerHTML = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#710">&quot;</span></span>;
                                        } <span style="color:#080;font-weight:bold">else</span> {
                                                m1p1serve.innerHTML = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#710">&quot;</span></span>;
                                                m1p2serve.innerHTML = <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">S</span><span style="color:#710">&quot;</span></span>;
                                        }
                                        ..
                                }
                                ...
                        } <span style="color:#080;font-weight:bold">catch</span> (exception) {
                                data = msg.data;
                                console.log(data);
                        }
                }
        }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Choose the appropriate WebSocket protocol according to the HTTP protocol currently used (secure or not)</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Check if the browser supports WebSocket API</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Create the WebSocket object</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Try to parse the JSON message sent by <em>peer server</em>, into the function called by <code>onmessage</code> Event Handler</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Check the received object type (MatchMessage or BetMessage) to achieve adequate treatment with DOM</td>
</tr>
</table>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To find out which browsers are compatible with <strong>WebSocket API</strong> <a href="http://caniuse.com/#search=websocket">visit the website caniuse.com</a>. Today, the latest versions of browsers are compatible excepted for Android and Opera Mini Browser, which represent, both together, only 3% of web traffic.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="source-code-on-github">Source code on Github</h3>
<div class="paragraph">
<p>You can <strong>fork this project on Github</strong> at <code><strong><a href="https://github.com/mgreau/javaee7-websocket">https://github.com/mgreau/javaee7-websocket</a></strong></code></p>
</div>
<div class="paragraph">
<p>This sample application is very basic, there could be many improvements like : managing a tournament with several games, betting on other criteria, see betting of other users in live&#8230;</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>'A feature that could be interesting technically, would be to create a new type of <strong>bet based on the coordinates of each winning point</strong>. Simply draw the ground through the HTML5 Canvas API and manage the coordinates selected by the user (such as winning point) and then compare with the actual coordinates at a point winner. '</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="build-and-deploy-the-war">Build and Deploy the WAR</h3>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Prerequisite :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JDK 7</p>
</li>
<li>
<p>Apache Maven 3.0.4+</p>
</li>
<li>
<p>Java EE 7 Application Server : Wildfly 8 ou Glassfish 4</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In order to build the WAR, you just have to execute the Maven command below ;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="text language-text">mvn clean package</code></pre>
</div>
</div>
<div class="paragraph">
<p>If your application server is WildFly, you can quickly deploy the WAR with the command below (WildFly has to be started) :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay"><code class="text language-text">mvn jboss-as:deploy</code></pre>
</div>
</div>
<div class="paragraph">
<p>The usopen application is then available at : <a href="http://localhost:8080/usopen/">http://localhost:8080/usopen/</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="benchmark-websocket-vs-rest">Benchmark : WebSocket VS REST</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to have some metrics about the performance of this new protocol, Arun Gupta has developed <a href="https://github.com/arun-gupta/javaee7-samples/tree/master/websocket/websocket-vs-rest">an application that allows compare the execution time of</a> the same treatment performed by WebSocket code and REST code.</p>
</div>
<div class="paragraph">
<p>Each endpoint (REST Endpoint and WebSocket Endpoint) just do an "echo" so they only return the flows they receive. The web interface of the application allows you to define the size of the message and the number of times that the message must be sent before the end of the test.</p>
</div>
<div class="paragraph">
<p>The benchmark results, shown below, are quite eloquent :</p>
</div>
<table class="tableblock frame-all grid-all" style="width:100%; ">
<colgroup>
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;"> 
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Request</th>
<th class="tableblock halign-left valign-top">Total execution time<br>
<strong>REST Endpoint</strong></th>
<th class="tableblock halign-left valign-top">Total execution time<br>
<strong>WebSocket Endpoint</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sending 10 messages of 1 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">220 ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7 ms</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sending 100 messages of 10 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">986 ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">57 ms</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sending 1000 messages of 100 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10 210 ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">179 ms</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sending 5000 messages of 1000 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">54 449 ms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1202 ms</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="references-about-websocket">References about WebSocket</h2>
<div class="sectionbody">
<div class="paragraph">
<p>I would particularly recommend <a href="https://twitter.com/arungupta">Arun Gupta</a>'s conferences, which allow you in less than 1 hour to discover and understand the WebSocket technology in general and the Java API for WebSocket.<br>
For more advanced information, the ideal is IETF, W3C and Java specifications.</p>
</div>
<div class="ulist bibliography">
<ul class="bibliography">
<li>
<p><a href="http://tools.ietf.org/html/rfc6455">RFC 6455: The WebSocket Protocol</a> - <em>IETF Specification</em></p>
</li>
<li>
<p><a href="http://w3.org/TR/websockets/">W3C: The WebSocket API</a> - <em>W3C Specification</em> (Candidate Recommandation)</p>
</li>
<li>
<p><a href="http://jcp.org/en/jsr/detail?id=356">JSR 356: Java API for WebSocket Protocol</a> - <em>Java Specification</em></p>
</li>
<li>
<p><a href="https://glassfish.java.net/adoptajsr/jsr356.html">Adopt a JSR - JSR 356</a></p>
</li>
<li>
<p><a href="http://www.youtube.com/watch?v=QqbuDFIT5To">Java EE 7 &amp; WebSocket API</a> - <em>Arun Gupta&#8217;s conference @ SF</em> (from the 46th minute)</p>
</li>
<li>
<p><a href="http://www.parleys.com/play/51c1cceae4b0ed8770356828/chapter4/about">Getting Started with WebSocket and SSE</a> - <em>Arun Gupta&#8217;s conference @ Devoxx UK 2013</em></p>
</li>
</ul>
</div>
<div class="paragraph">
<p><em>This article was structured based on the UK 2013 Devoxx conference.</em></p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="conclusion">Conclusion</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This article has introduced, through a concrete example, <strong>the WebSocket protocol, the HTML5 WebSocket API and Java API for WebSocket released with Java EE 7</strong>. It was already possible to use WebSocket with Java frameworks like <a href="http://async-io.org/download.html">Atmosphere</a> but lacked a standard.<br>
Today all <strong>standards are completed or about to be</strong>, this new technology meets a specific need and is promising in terms of performance. To be heavily used, this protocol will need to be allowed in businesses where often only the HTTP protocol is permitted.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2013-12-10 17:23:48 CET
</div>
</div>
</body>
</html>